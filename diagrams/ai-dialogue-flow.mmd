sequenceDiagram
    participant U as User
    participant FE as Frontend
    participant GW as API Gateway
    participant NS as Newsletter Service
    participant FS as Firestore
    participant VAI as Vertex AI
    
    U->>FE: プロンプト入力
    FE->>GW: 再生成リクエスト
    GW->>NS: Forward request
    NS->>FS: 現在の連絡帳取得
    FS-->>NS: 連絡帳データ
    NS->>VAI: プロンプト付き再生成
    Note over NS,VAI: ユーザープロンプト<br/>+ 現在のデータ
    VAI-->>NS: 新バージョン
    NS->>FS: 新バージョン保存
    NS-->>FE: 更新結果
    FE-->>U: 表示更新